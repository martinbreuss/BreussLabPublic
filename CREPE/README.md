# CREPE (CREate Primers and Evaluate)

## Overview

CREPE is a batch primer design and specificity analysis tool. It uses Primer3 (https://primer3.org/) to create primers from an input CSV of target sites. It then uses UCSC's In-Silico PCR (https://genome.ucsc.edu/cgi-bin/hgPcr) to identify off-target enrichment sites for each primer pair. Lastly, Python functions perform specificity analysis to determine troublesome off-target sites. 

This version of CREPE is designed to create primer pairs for 150bp short-read sequencing. As such, it first attempts to find primer pairs that generate a 200bp amplicon. We called these 'ideal'. We've found that an 'ideal' primer pair will be created for about 70% of input target sites. For the remaining input sites, CREPE will create a right-anchored primer pair and, if necessary, a left-anchored primer pair. The anchor refers to one of the primers being bound close to the variant of interest while the opposing primer has a larger sequence to attempt to bind to. For example, the right-anchored primer pairs give the forward primer 300bp to find a binding site while the reverse primer will bind close to the target site (within 100bp). The amplicons generated by these anchored pairs can be as large as 500bp. In this way, CREPE attempts to create functional primer pairs for every input target site. 

CREPE runs efficiently on local machines, no HPC is needed. Although, you can run it on an HPC if that's most convenient. 

## Installation

CREPE runs with few dependencies and a simple conda environment. The simplest install method might be to download and extract the tarball. However, cloning this repository should also work. In any case, the following instructions will help you prepare the files and environment needed for CREPE to run.

### 1. To begin, download and extract the tar file:

    tar -xvzf crepe_download.tar.gz

### 2. Gunzip all_repeats.bed file

    gunzip all_repeats.b38_new.bed.gz

### 3. Build the CREPE anaconda environment by running the following command:

    conda env create --name crepe --file=env.yaml

If you have an issue creating the environment from the env.yaml file, then use the following commands to create your environment:

    1. conda create -n crepe python=3.9.12
    2. conda activate crepe
    3. conda install pandas=1.4.2
    4. conda install bioconda::pysam
    5. conda install conda-forge::biopython=1.79
    6. conda install bioconda::bedtools
    7. conda install bioconda::primer3
    8. conda install bioconda::ispcr
    

It should take less than 10 minutes to build the environment.

### 4. If you have an issue with the tar file, Git clone this directory:

    1. git clone -b main https://github.com/martinbreuss/BreussLabPublic


## Usage

The input CSV file can contain as many columns as you like. However the chromosome column must be labeled CHROM, the position must be POS, and the project ID must be PROJ. This is shown in the clinvar10_demo.csv file.

### 1. This is the command structure to run CREPE:

    python CREPE_v1.02.py input.csv ref_genome.fa output_directory proj_id

### 2. This is an example command:

    python CREPE_v1.02.py clinvar10_demo.csv hg38.fa test_crepe test_crepe10

The final output file with the list of primers starts with the prefix: FINAL_OUTPUT_FILE... We are working to clean up the output intermediary files. (02/25/2025)

## Updates

The Python script will be updated to improve performance and allow the user to prioritize amplicons different than the 200bp size we've chosen. Please reach out to Jon (jonathan[dot]pitsch@cuanschutz[dot]edu) if you have any issues using CREPE. 


